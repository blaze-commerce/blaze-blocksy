#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-push hook for comprehensive validation
# Ensures all commits meet quality standards before remote push

echo "ğŸš€ Running pre-push quality validation..."
echo "ğŸ“– Reference: .augment/rules/ALWAYS-comprehensive-code-review-standards.md"

# Validate branch naming convention
echo "ğŸŒ¿ Validating branch naming convention..."
npm run branch:validate

# Check branch naming validation exit code
if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Branch naming validation failed"
    echo "ğŸ’¡ Rename your branch to follow naming conventions"
    echo "ğŸ”§ Get help: npm run branch:help"
    echo "ğŸš¨ Emergency bypass: EMERGENCY_BYPASS=true git push"
    echo ""
    exit 1
fi

echo "âœ… Branch naming validation passed"

# Run comprehensive pre-push quality check
npm run quality:pre-push

# Check exit code
if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Pre-push quality validation failed"
    echo "ğŸ’¡ Fix the issues above before pushing to remote"
    echo "ğŸ”§ Emergency bypass: EMERGENCY_BYPASS=true git push"
    echo "âš ï¸ Emergency bypass should only be used for critical production fixes"
    echo ""
    exit 1
fi

echo "âœ… Pre-push quality validation passed"
